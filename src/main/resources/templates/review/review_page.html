<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">

<head>

<!-- moment.js 포함 (필수) -->
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<!-- daterangepicker CSS 포함 -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<!-- daterangepicker JS 포함 -->
<script
	src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<!-- 커스텀 CSS 추가 -->
<link rel="stylesheet" href="/css/review_page.css">
<link rel="stylesheet" href="/css/category.css">

   <!-- 지도 API 포함 -->
   <script type="text/javascript"
      src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4711bf21a08674cf6e20b64443d34887"></script>


<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>
<div layout:fragment="content">
	 <!-- 검색란 -->
   <div class="section1 container mt-5">
      <div class="row d-flex justify-content-end">
         <!--지역선택-->
         <div class="col-auto">
            <select name="h_area1" id="region1" onChange="updateSubRegion()" class="h_area1 form-control">
               <option>-지역선택-</option>
               <option value="seoul">서울</option>
               <option value="busan">부산</option>
               <option value="gyeonggi">경기도</option>
               <option value="daegu">대구</option>
               <!-- 기타 지역들 추가 -->
            </select>
         </div>



<div class="col-auto">
    <select name="h_area2" id="region2" class="form-control">
        <option>-선택-</option>
    </select>
</div>

			<!--인원수 선택-->
			<div class="col-auto">
				<!--People Count Button-->
				<button class="btn text-secondary bg-white  P_C_button category_btn"
					id="toggleButton">
					인원수<i class="fa-solid fa-user ml-1"></i>
				</button>
				<!--인원수 박스-->
				<div class="card ml-5 mt-5 hide_box" id="rangeBox"
					style="width: 300px;">
					<div class="card-body text-center">
						<span>인원</span> <label id="rangeValue" for="customRange2">1</label><span>명</span>
						<input type="range" class="custom-range" min="1" max="10"
							value="1" id="customRange2">
					</div>
					<button class="btn btn-dark ca_button w-100">인원수 적용</button>
				</div>
			</div>
			<!--인원수 선택 끝-->

			<!-- 날짜 선택 -->
			<div class="col-auto">
				<button id="calendar-btn"
					class="btn btn-out bg-white text-secondary category_btn">
					날짜 선택 <i class="fa-solid fa-calendar-days"></i>
				</button>
				<input type="button" name="datetimes" id="calendar-input" disabled
					class="btn" />

			</div>
			<!-- 날짜 선택 끝 -->

			<!--메뉴 선택-->
			<div class="col-auto">
				<button class="btn text-secondary bg-white  category_btn menu_btn">
					메뉴 <i class="fa-solid fa-utensils"></i>
				</button>
				<div class="card food_box">
					<div class="card-body m_card_body row justify-content-center ">
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/bibimbap_8740490.png" alt="food_icon"
								class="icon">
							<div class="text">한식</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_Chinese.png" alt="food_icon"
								class="icon">
							<div class="text">중식</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_japan.png" alt="food_icon"
								class="icon">
							<div class="text">일식</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_Western.png" alt="food_icon"
								class="icon">
							<div class="text">양식</div>
						</button>
						<button class="btn border btn-icon col-3 ">
							<img src="/img/icon/food_i_fast.png" alt="food_icon" class="icon">
							<div class="text ">패스트푸드</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_asian.png" alt="food_icon"
								class="icon">
							<div class="text">아시안</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_omakase.png" alt="food_icon"
								class="icon">
							<div class="text">오마카세</div>
						</button>
						<button class="btn border btn-icon col-3">
							<img src="/img/icon/food_i_dongne.png" alt="food_icon"
								class="icon">
							<div class="text">동네맛집</div>
						</button>
					</div>
				</div>
			</div>
			<!--메뉴 선택 끝-->


         <!-- 지도 선택 -->
         <div class="col-auto">
            <button class="btn text-secondary bg-white category_btn" onclick="showMap()">
               지도 선택<i class="fa-solid fa-map ml-1"></i>
            </button>
         </div>
     
  </div>
      <hr>
  <div id="map"></div>
   
   <button id="closeMap" onclick="closeMap()">지도 닫기</button>

    </div>
	<!-- section1 끝 -->

   <!-- 지도 요소 -->
 

	<!--중간 긴 캐로셀-->
	<div class="section2 my-5">
		<div class="container my-5">
			<div id="carouselExampleFade" class="carousel slide my-5"
				data-ride="carousel">
				<ol class="carousel-indicators">
					<li data-target="#carouselExampleCaptions" data-slide-to="0"
						class="active"></li>
					<li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
				</ol>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<img src="/img/sub_carousel/carousel_1.png" class="d-block w-100"
							alt="...">
					</div>
					<div class="carousel-item">
						<img src="/img/sub_carousel/carousel_2.png" class="d-block w-100"
							alt="...">
					</div>
				</div>
				<button class="carousel-control-prev" type="button"
					data-target="#carouselExampleFade" data-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="sr-only">Previous</span>
				</button>
				<button class="carousel-control-next" type="button"
					data-target="#carouselExampleFade" data-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="sr-only">Next</span>
				</button>
			</div>
		</div>
	</div>

	<!-- 순서필터 -->
	<div class="container">
		<div class="row justify-content-between align-items-center">
			<div class="col-auto">
				<!-- 전체 버튼 -->
				<div class="dropdown">
					<button class="btn bg-white dropdown-toggle" type="button"
						data-toggle="dropdown" aria-expanded="false">전체</button>
					<div class="dropdown-menu">
						<a class="dropdown-item" href="#">전체</a> <a class="dropdown-item"
							href="#">새로 올라온 순</a> <a class="dropdown-item" href="#">오래된 순</a>
						<a class="dropdown-item" href="#">별점 순</a> <a
							class="dropdown-item" href="#">댓글 많은 순</a> <a
							class="dropdown-item" href="#">좋아요 순</a>
					</div>
				</div>
				<!--dropdown-->
			</div>
			<div class="col-auto d-flex align-items-center">
				<!-- 검색란 -->
				<div class="d-flex align-items-center">
					<!-- 동그란 끝부분을 가진 검색바 -->
					<input type="text" class="form-control custom-search-bar"
						placeholder="검색어를 입력하세요">
					<button class="btn btn-dark ml-2" style="width: 70px;">검색</button>
					<!-- 검색 버튼 -->
				</div>
			</div>
		</div>
		<!--row-->
		<hr>
	</div>
	<!--순서 container-->





	<!--card-->
	<div class="section3 mt-5">
		<div class="container my-5 ">
			<h3 class="mt-5">
				이번주 <span class="text-danger">🔥HOT한</span> 리뷰
			</h3>
			<div class="row S3_review_card">
			<!-- 리뷰 카드 -->
				<div class="col-xl-4 col-lg-6 my-2" th:each="review : ${reviewPage}">
					<div class="card S3_card h-100 custom-border mx-auto">
						<a th:href="@{/review_detail/{id}(id=${review.id})}"
							class="text-dark">
							<h5 class="d-flex align-items-center mt-3 ml-3 mb-2">
								<!-- 리뷰 작성자 프로필 이미지 -->
								<img
									th:src="@{${review.user.imageUrl} != null ? ${review.user.imageUrl} : '/img/user/default-profile.png'}"
									alt="user_img" class="rounded-circle"
									style="width: 50px; height: 50px">
								<!-- 리뷰 작성자 사용자명 -->
								<span class="d-flex align-items-center mx-2"
									th:text="${review.user.nickname}"></span>
							</h5>
						</a>

						<div th:id="'S3_review_carouselExample' + ${review.id}"
							class="carousel slide carousel-fade px-2" data-ride="carousel">
							<div class="carousel-inner S3_carousel-inner">
								<a th:href="@{/review_detail/{id}(id=${review.id})}">
									<div class="carousel-item S3_carousel-item"
										th:each="imageMap, iterStat : ${review.reviewImageMap}"
										th:classappend="${iterStat.index == 0} ? ' active'">
										<img th:src="@{${imageMap.reviewImage.filepath}}"
											alt="Review detail Image"
											class="d-block w-100 S3_custom-card-img">
									</div>
								</a>
							</div>
							<!-- 캐러셀 제어 버튼 -->
							<div class="d-block d-lg-none">
								<a class="carousel-control-prev S3_hover_btn"
									th:href="'#S3_review_carouselExample' + ${review.id}"
									role="button" data-slide="prev"> <span
									class="carousel-control-prev-icon" aria-hidden="true"></span> <span
									class="sr-only">Previous</span>
								</a> <a class="carousel-control-next S3_hover_btn"
									th:href="'#S3_review_carouselExample' + ${review.id}"
									role="button" data-slide="next"> <span
									class="carousel-control-next-icon" aria-hidden="true"></span> <span
									class="sr-only">Next</span>
								</a>
							</div>
						</div>


						<div class="card-body d-flex flex-column">
							<div class="row p-3 S3_text-box ">
								<!-- 리뷰 제목 -->
								<div class="col-8 mx-0">
									<a th:href="@{/review_detail/{id}(id=${review.id})}"
										class="text-dark">
										<h5 class="card-title S3_card-title" th:text="${review.title}"></h5>
									</a>
								</div>

								<!-- 댓글과 좋아요가 한 줄에 배치된 부분 -->
								<div class="col-4 text-right d-flex justify-content-end"
									style="margin-top: -35px;">
									<!-- 댓글 -->
									<div class="d-flex align-items-center ">
										<img src="/img/icon/chat.png" alt="comment"
											style="width: 20px;" /> <span class="text-dark mx-1"
											style="margin-top: 2px;">566</span>
									</div>

									<!-- 좋아요 -->
									<div class="d-flex align-items-center like_box ml-1">
										<!-- 리뷰 ID를 동적으로 설정 -->
										<input type="hidden" class="review-id" th:value="${review.id}">
										<!-- likedByUser 상태를 동적으로 설정 -->
										<input type="hidden" class="liked-by-user"
											th:value="${likeStatusMap[review.id].liked}"> <i
											th:id="'like-btn-' + ${review.id}"
											class="tap_btn like_btn fa-regular fa-heart"></i> <span
											class="like-count ml-1"
											th:text="${likeStatusMap[review.id].likeCount}"></span>
									</div>
								</div>


									<!-- 식당정보 -->
								<!-- 서버에서 리뷰 리스트를 반복해서 출력 -->
								<p class="col-12 S3_store mb-1" th:each="review : ${reviews}">
									<!-- 각 리뷰의 고유 ID를 data-review-id에 삽입 -->
								<div class="starRating" th:data-review-id="${review.id}"></div>
								<a href="" style="text-decoration: none;"> <small
									class="text-muted"> <i
										class="fa-solid fa-location-dot mx-2" style="color: #000000;"></i>
										<span class="font-weight-bold">수원역 근처</span> <span>돼지냠냠</span>
								</small>
								</a>
								</p>

								<!-- 리뷰내용 -->
								<p class="card-text S3_card-text mt-2 col-12 mb-2"
									th:text="${review.content}"></p>


								<!-- 리뷰태그 -->
								<div class="mb-3 S3_tag_box ml-1">
									<span th:each="tagMap : ${review.tagMaps}" calss="S3_tag_box">
										<span class="badge badge-pill border border-dark"
										th:text="'#'+${tagMap.reviewTag.name}"> </span>
									</span>

									<p class="card-text mt-2">
										<small class="text-muted"> <span
											th:text="${#temporals.format(review.createDate, 'yyyy-MM-dd HH:mm')}"></span>
											업데이트
										</small>
									</p>
								</div>
								<!--tag-->

							</div>
							<!--row-->

						</div>
						<!--card-body-->

					</div>
					<!--card-->

				</div>
				<!--col-lg-4-->

			</div>
			<!--row-->

		</div>
		<!--container-->


		<div class="container">
			<h3 class="mt-5 my-3">새로 올라온 후기</h3>

		</div>
		<!--container-->
	</div>
	<!-- section -->


 <!-- 지도 데이터 표시 -->
   <div th:each="store : ${stores}">
       <input type="hidden" class="store-lat" th:value="${store.storeLatitude}" />
       <input type="hidden" class="store-lng" th:value="${store.storeLongitude}" />
       <input type="hidden" class="store-name" th:value="${store.storeName}" />
   </div>
	<script src="/js/review_page_like.js"></script>
  
<!-- 자바스크립트 파일 포함 (라이브러리 이후에 로드) -->
<script src="js/review_page_category.js"></script>


</div>

</html>