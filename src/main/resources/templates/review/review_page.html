<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- moment.js Ìè¨Ìï® (ÌïÑÏàò) -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <!-- daterangepicker CSS Ìè¨Ìï® -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <!-- daterangepicker JS Ìè¨Ìï® -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <!-- Ïª§Ïä§ÌÖÄ CSS Ï∂îÍ∞Ä -->
    <link rel="stylesheet" href="/css/review_page.css">
    <link rel="stylesheet" href="/css/category.css">
    <!-- ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏ ÌååÏùº Ìè¨Ìï® (ÎùºÏù¥Î∏åÎü¨Î¶¨ Ïù¥ÌõÑÏóê Î°úÎìú) -->
    <script src="js/review_page_category.js"></script>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <!-- ÏßÄÎèÑ API Ìè¨Ìï® -->
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4711bf21a08674cf6e20b64443d34887"></script>

    <style>
        #map {
            display: none; /* Ï¥àÍ∏∞ÏóêÎäî ÏßÄÎèÑÍ∞Ä Î≥¥Ïù¥ÏßÄ ÏïäÎèÑÎ°ù ÏÑ§Ï†ï */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }
        #closeMap {
            display: none; /* Ï¥àÍ∏∞ÏóêÎäî Î≤ÑÌäºÏù¥ Î≥¥Ïù¥ÏßÄ ÏïäÎèÑÎ°ù ÏÑ§Ï†ï */
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1001;
            background-color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<div layout:fragment="content">
    <!-- Í≤ÄÏÉâÎûÄ -->
    <div class="section1 container mt-5">
        <div class="row d-flex justify-content-end">
            <!--ÏßÄÏó≠ÏÑ†ÌÉù-->
            <div class="col-auto">
                <select name="h_area1" id="region1" onChange="updateSubRegion()" class="h_area1 form-control">
                    <option>-ÏßÄÏó≠ÏÑ†ÌÉù-</option>
                    <option value="seoul">ÏÑúÏö∏</option>
                    <option value="busan">Î∂ÄÏÇ∞</option>
                    <option value="gyeonggi">Í≤ΩÍ∏∞ÎèÑ</option>
                    <option value="daegu">ÎåÄÍµ¨</option>
                    <!-- Í∏∞ÌÉÄ ÏßÄÏó≠Îì§ Ï∂îÍ∞Ä -->
                </select>
            </div>

            <!--ÎèôÎÑ§ ÏÑ†ÌÉù-->
            <div class="col-auto">
                <select name="h_area2" id="region2" class="form-control">
                    <option>-ÏÑ†ÌÉù-</option>
                </select>
            </div>

            <!--Ïù∏ÏõêÏàò ÏÑ†ÌÉù-->
            <div class="col-auto">
                <!--People Count Button-->
                <button class="btn text-secondary bg-white P_C_button category_btn" id="toggleButton">
                    Ïù∏ÏõêÏàò<i class="fa-solid fa-user ml-1"></i>
                </button>
                <!--Ïù∏ÏõêÏàò Î∞ïÏä§-->
                <div class="card ml-5 mt-5 hide_box" id="rangeBox" style="width: 300px;">
                    <div class="card-body text-center">
                        <span>Ïù∏Ïõê</span> <label id="rangeValue" for="customRange2">1</label><span>Î™Ö</span>
                        <input type="range" class="custom-range" min="1" max="10" value="1" id="customRange2">
                    </div>
                    <button class="btn btn-dark ca_button w-100">Ïù∏ÏõêÏàò Ï†ÅÏö©</button>
                </div>
            </div>

            <!-- ÎÇ†Ïßú ÏÑ†ÌÉù -->
            <div class="col-auto">
                <button id="calendar-btn" class="btn btn-out bg-white text-secondary category_btn">
                    ÎÇ†Ïßú ÏÑ†ÌÉù <i class="fa-solid fa-calendar-days"></i>
                </button>
                <input type="button" name="datetimes" id="calendar-input" disabled class="btn" />
            </div>

            <!-- Î©îÎâ¥ ÏÑ†ÌÉù -->
            <div class="col-auto">
                <button class="btn text-secondary bg-white category_btn menu_btn">
                    Î©îÎâ¥ <i class="fa-solid fa-utensils"></i>
                </button>
                <div class="card food_box">
                    <div class="card-body m_card_body row justify-content-center ">
                        <button class="btn border btn-icon col-3">
                            <img src="/img/icon/bibimbap_8740490.png" alt="food_icon" class="icon">
                            <div class="text">ÌïúÏãù</div>
                        </button>
                        <!-- Í∏∞ÌÉÄ Î©îÎâ¥Îì§ Ï∂îÍ∞Ä -->
                    </div>
                </div>
            </div>

            <!-- ÏßÄÎèÑ ÏÑ†ÌÉù -->
            <div class="col-auto">
                <button class="btn text-secondary bg-white category_btn" onclick="showMap()">
                    ÏßÄÎèÑ ÏÑ†ÌÉù<i class="fa-solid fa-map ml-1"></i>
                </button>
            </div>
        </div>
        <hr>
    </div>

    <!-- ÏßÄÎèÑ ÏöîÏÜå -->
    <div id="map"></div>
    <button id="closeMap" onclick="closeMap()">ÏßÄÎèÑ Îã´Í∏∞</button>

    <!-- Ï§ëÍ∞Ñ Í∏¥ Ï∫êÎ°úÏÖÄ -->
    <div class="section2 my-5">
        <div class="container my-5">
            <div id="carouselExampleFade" class="carousel slide my-5" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
                </ol>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="/img/sub_carousel/carousel_1.png" class="d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="/img/sub_carousel/carousel_2.png" class="d-block w-100" alt="...">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-target="#carouselExampleFade" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-target="#carouselExampleFade" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ÏàúÏÑúÌïÑÌÑ∞ -->
    <div class="container">
        <div class="row justify-content-between align-items-center">
            <div class="col-auto">
                <!-- Ï†ÑÏ≤¥ Î≤ÑÌäº -->
                <div class="dropdown">
                    <button class="btn bg-white dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">Ï†ÑÏ≤¥</button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="#">Ï†ÑÏ≤¥</a>
                        <a class="dropdown-item" href="#">ÏÉàÎ°ú Ïò¨ÎùºÏò® Ïàú</a>
                        <a class="dropdown-item" href="#">Ïò§ÎûòÎêú Ïàú</a>
                        <a class="dropdown-item" href="#">Î≥ÑÏ†ê Ïàú</a>
                        <a class="dropdown-item" href="#">ÎåìÍ∏Ä ÎßéÏùÄ Ïàú</a>
                        <a class="dropdown-item" href="#">Ï¢ãÏïÑÏöî Ïàú</a>
                    </div>
                </div>
            </div>
            <div class="col-auto d-flex align-items-center">
                <!-- Í≤ÄÏÉâÎûÄ -->
                <div class="d-flex align-items-center">
                    <input type="text" class="form-control custom-search-bar" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    <button class="btn btn-dark ml-2" style="width: 70px;">Í≤ÄÏÉâ</button>
                </div>
            </div>
        </div>
        <hr>
    </div>

    <!-- Ïπ¥Îìú ÏÑπÏÖò -->
    <div class="section3 mt-5">
        <div class="container my-5">
            <h3 class="mt-5">Ïù¥Î≤àÏ£º <span class="text-danger">üî•HOTÌïú</span> Î¶¨Î∑∞</h3>
            <div class="row">
                <div class="col-xl-4 col-lg-6 my-2" th:each="review : ${reviewPage}">
                    <div class="card S3_card h-100 custom-border mx-auto">
                        <a href="" class="text-dark">
                            <h5 class="d-flex align-items-center mt-3 ml-3">
                                <img src="/img/profile/1.jpg" alt="" class="rounded-circle" style="width: 50px;">
                                <span class="d-flex align-items-center mx-2">ÎßõÏßëÌóåÌÑ∞</span>
                            </h5>
                        </a>
                        <div th:id="'S3_review_carouselExample' + ${review.id}" class="carousel slide carousel-fade px-2" data-ride="carousel">
                            <div class="carousel-inner S3_carousel-inner">
                                <a th:href="@{/review_detail/{id}(id=${review.id})}">
                                    <div class="carousel-item S3_carousel-item" th:each="imageMap, iterStat : ${review.reviewImageMap}"
                                        th:classappend="${iterStat.index == 0} ? ' active'">
                                        <img th:src="@{${imageMap.reviewImage.filepath}}" alt="Review detail Image" class="d-block w-100 S3_custom-card-img">
                                    </div>
                                </a>
                            </div>
                            <!-- Ï∫êÎü¨ÏÖÄ Ï†úÏñ¥ Î≤ÑÌäº -->
                            <div class="d-block d-lg-none">
                                <a class="carousel-control-prev S3_hover_btn" th:href="'#S3_review_carouselExample' + ${review.id}" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next S3_hover_btn" th:href="'#S3_review_carouselExample' + ${review.id}" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                        </div>

                        <div class="card-body d-flex flex-column">
                            <div class="row p-3 S3_text-box ">
                                <div class="col-8 mx-0">
                                    <a th:href="@{/review_detail/{id}(id=${review.id})}" class="text-dark">
                                        <h5 class="card-title S3_card-title" th:text="${review.title}"></h5>
                                    </a>
                                </div>
                                <div class="col-4 text-end text-right likes">
                                    <span class="text-dark mx-1"><img src="/img/icon/heart-regular.svg" alt="like" style="width: 20px" class="img-fluid mr-1" />566</span>
                                </div>

                                <p class="col-12 S3_store mb-2">
                                    <small>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</small> <a href=""><small class="text-muted"><i class="fa-solid fa-location-dot mx-2" style="color: #000000;"></i>
                                        <span class="font-weight-bold">ÏàòÏõêÏó≠ Í∑ºÏ≤ò</span> ÎèºÏßÄÎÉ†ÎÉ†</small></a>
                                </p>

                                <p class="card-text S3_card-text mt-auto col-12 mb-2" th:text="${review.content}"></p>

                                <div class="mb-3 S3_tag_box ml-1">
                                    <span th:each="tagMap : ${review.tagMaps}" class="S3_tag_box">
                                        <span class="badge badge-pill border border-dark" th:text="'#'+${tagMap.reviewTag.name}"> </span>
                                    </span>
                                    <p class="card-text mt-2">
                                        <small class="text-muted"><span th:text="${#temporals.format(review.createDate, 'yyyy-MM-dd HH:mm')}"></span> ÏóÖÎç∞Ïù¥Ìä∏</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <h3 class="mt-5 my-3">ÏÉàÎ°ú Ïò¨ÎùºÏò® ÌõÑÍ∏∞</h3>
        </div>
    </div>

    <script>
        var map;

        function updateSubRegion() {
            var region1 = document.getElementById('region1').value;
            var region2 = document.getElementById('region2');
            region2.innerHTML = '';

            if (region1 === 'seoul') {
                var options = [
                    { name: 'Í∞ïÎÇ®Íµ¨', value: '37.517236,127.047325' },
                    { name: 'ÏÑúÏ¥àÍµ¨', value: '37.530125,126.975403' }
                ];
            } else if (region1 === 'busan') {
                var options = [
                    { name: 'Ìï¥Ïö¥ÎåÄÍµ¨', value: '35.179554,129.075641' },
                    { name: 'ÏàòÏòÅÍµ¨', value: '35.127329,128.980051' }
                ];
            } // Í∏∞ÌÉÄ ÏßÄÏó≠Îì§Ïóê ÎåÄÌïú ÏÜåÎ∂ÑÎ•ò Ï∂îÍ∞Ä

            for (var i = 0; i < options.length; i++) {
                var option = document.createElement('option');
                option.value = options[i].value;
                option.text = options[i].name;
                region2.add(option);
            }
        }

        function showMap() {
            var mapDiv = document.getElementById('map');
            var closeButton = document.getElementById('closeMap');
            var selectedRegion = document.getElementById('region2').value;
            var coords = selectedRegion.split(',');
            var lat = parseFloat(coords[0]);
            var lng = parseFloat(coords[1]);

            if (!map) {
                mapDiv.style.display = 'block';
                var container = mapDiv;
                var options = {
                    center: new kakao.maps.LatLng(lat, lng),
                    level: 3
                };
                map = new kakao.maps.Map(container, options);
            } else {
                mapDiv.style.display = 'block';
                map.relayout();
                var moveLatLon = new kakao.maps.LatLng(lat, lng);
                map.setCenter(moveLatLon);
            }

            closeButton.style.display = 'block';
        }

        function closeMap() {
            var mapDiv = document.getElementById('map');
            var closeButton = document.getElementById('closeMap');
            mapDiv.style.display = 'none';
            closeButton.style.display = 'none';
        }
    </script>
</div>
</html>
