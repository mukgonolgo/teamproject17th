<html layout:decorate="~{layout}">
	<div layout:fragment="content">
		<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

	    <style>
			.S1_d_cr {
			    background-color: #ffffff;
			    padding: 20px;
			    max-width: 800px;
			    margin: 0 auto;
			    border: 1px solid #e0e0e0;
			    box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
			}
			
			label {
			    font-size: 14px;
			    color: #333333;
			    display: block;
			    margin-bottom: 8px;
			}

			select,
			input[type="text"],
			textarea {
			    width: 100%;
			    padding: 10px;
			    margin-bottom: 20px;
			    border: 1px solid #e0e0e0;
			    border-radius: 4px;
			    font-size: 14px;
			    box-sizing: border-box;
			}

			textarea {
			    height: 150px;
			    resize: none;
			}




			button[type="submit"] {
			    width: 100%;
			    background-color: rgb(255, 223, 228);
			    color: white;
			    padding: 12px;
			    border: none;
			    border-radius: 4px;
			    font-size: 16px;
			    cursor: pointer;
			}

			button[type="submit"]:hover {
			    background-color: rgb(128, 128, 128);
			}

			.product-info {
			    display: flex;
			    gap: 10px;
			}

			.product-info input {
			    flex: 1;
			}

			/* 카테고리 크기 조절 */
			select {
			    max-width: 300px;
			}

			/* 커스텀 파일 선택 스타일 */
			.file-upload {
			    display: flex;
			    align-items: center;
			}

			.icon-container {
			    display: flex;
			    align-items: center;
			    gap: 5px;
			    /* 이미지와 + 버튼 사이의 간격 조절 */
			}

			.icon {
			    width: 100px;
			    height: 100px;
			    background-color: #fafafa;
			    border: 2px dashed #d0d0d0;
			    border-radius: 4px;
			    text-align: center;
			    cursor: pointer;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			}
			.S1_d_cr_title{
				display: flex;
				justify-content: center;
				padding: 50px;
			}

			.uploaded-image {
			    width: 100px;
			    height: 100px;
			    object-fit: cover;
			    border-radius: 4px;
			    border: 1px solid #e0e0e0;
			}

			.img-container {
			    position: relative;
			    width: 100px;
			    height: 100px;
			}
			
	        .tag-btn {
	            margin: 5px 0 5px 5px;
	            background-color: #d0d0d0;
	        }
			.input{
				margin: 20px 0 10px;
			}
	        .selected {
	            background-color: #007bff; /* 선택된 버튼의 배경색 */
	            color: white; /* 선택된 버튼의 글자색 */
	        }
	        .error-message {
	            color: red;
	            margin-top: 10px;
				font-size: 10px;
	        }
			.cateGroup,.tagGroup{
				display: flex;
				justify-content: center;
				flex-wrap: wrap;
				margin: 50px 0 30px;
			}
			.storaddress>.form-group {
			    display: flex;
			    align-items: center;
			    margin-bottom: 10px;
				
			}
			.required{
				margin-right: 2px;
			}

			.address-button {
			    padding: 7px;
			    border-radius: 5px;
			    background-color: #ddd;
			    border: 1px solid #ccc;
			    cursor: pointer;
				margin-bottom: 20px;

				white-space: nowrap;
			}
			.store_btn{
				margin: 90px 0 70px;
			}
			
			
			
			
			
			/* 반응형 스타일 */
			@media (max-width: 800px) { /* col-lg 이하 */
				.S1_d_cr {
				    border: none;
				    box-shadow: none;
				}

			}


			
	    </style>
	</head>
	<body>
		
		<!-- CSRF 토큰을 제대로 설정하기 위해 name="_csrf"로 변경 -->
		    <form id="storeForm" th:action="@{/store/create}" method="post">
		        <input type="hidden" name="_csrf" value="${_csrf.token}" />

		        <div class="S1_d_cr">
					<h2 class="S1_d_cr_title">식당 등록</h2>
					<!-- 식당 이름 필드 -->
					<!-- 프리미엄 광고 여부 선택 -->
					    <div class="form-group input">
					        <h5>프리미엄 광고 여부</h5>
					        <div>
					            <input type="radio" id="premiumYes" name="isPremium" value="true">
					            <label for="premiumYes">예</label>
					            
					            <input type="radio" id="premiumNo" name="isPremium" value="false">
					            <label for="premiumNo">아니오</label>
					        </div>
					    </div>

					<div class="form-group input">
						<label for="storeName"><h5>식당 이름</h5></label>
						<input type="text" id="storeName" name="storeName" placeholder="제목을 입력하세요...">
					</div>

					<!-- 파일 업로드 필드 -->
					<div class="form-group input">
		            	<label for="file-upload" class="mb-3"><h5>파일(식당 외관, 음식, 메뉴사진을 추가해 주세요!)</h5></label>       
		                <div class="icon-container">
		                    <div class="icon" id="add-icon" onclick="document.getElementById('file-upload').click();">
		                        <span id="file-icon" style="font-size: 50px; color: #d0d0d0;">+</span>
		                    </div>
		                    <input type="file" id="file-upload" name="fileUpload" accept="image/*" onchange="addImage(event)" style="display: none;" multiple>
		                </div>
		            </div>

					<!-- 전화번호 입력 -->
					<div class="form-group input">
						<label for="storeNumber" class="mb-3"><h5>전화번호</h5></label>
						<input type="text" id="storeNumber" name="storeNumber" placeholder="'-'빼고 입력해 주세요">
					</div>

					<!-- 영업시간 -->
		            <div class="storetimegroup input">
						<h5 class="mb-3">영업시간</h5>
		                <div class="time_check row">
		                    <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
		                        <label for="StoreStarttime">시작 시간:</label>
		                        <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreStarttime" id="StoreStarttime" placeholder="00:00 형식으로 입력" oninput="generateButtons()" />
		                    </div>              
		                    <p class="d-none d-md-flex mt-1 align-items-center">~</p>
		                    <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
		                        <label for="StoreEndTime">마감 시간:</label>
		                        <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreEndTime" id="StoreEndTime" placeholder="00:00 형식으로 입력" oninput="generateButtons()" />
		                    </div>
		                </div>
		                <div class="error-message" id="error1" style="display: none;"></div>
		            </div>

					<!-- 주소 입력 -->
					<div class="storaddress input">
						<h5 class="mb-3">주소 입력</h5>
						<!-- 우편번호 -->
						<div class="form-group m-1">
						    <label class="mb-4"><span class="required">*</span>우편 번호</label>
						    <input type="text" id="postcode" name="postcode" class="ml-2 col-6 col-md-3" readonly required>
						    <button type="button" class="address-button ml-2 col-3 col-md-2" onclick="sample6_execDaumPostcode()">주소 찾기</button>
						</div>
						<!-- 기본 주소 -->
						<div class="form-group m-1">
						    <label class="mb-4"><span class="required">*</span>기본 주소</label>
						    <input type="text" id="basicAddress" name="basicAddress" class="ml-2 col-9 col-md-5" readonly required>
						</div>

						<!-- 상세 주소 -->
						<div class="form-group m-1">
						    <label class="mb-4"><span class="required">*</span>상세 주소</label>
						    <input type="text" id="detailAddress" name="detailAddress" class="ml-2 col-9 col-md-5" required>
						</div>
						
						<!-- 위도 및 경도 필드 -->
						<div class="">
						    <div class="form-group">
						        <label class="mb-4"><span class="required">*</span>위도</label>
						        <input type="text" id="storeLatitude" name="storeLatitude" class="col-12 col-md-5" readonly>
						    </div>
						    <div class="form-group">
						        <label class="mb-4"><span class="required">*</span>경도</label>
						        <input type="text" id="storeLongitude" name="storeLongitude" class="col-12 col-md-5" readonly>
						    </div>
						</div>
						<p id="result"></p>
					</div>

					<!-- 설명 입력 -->
					<div class="form-group input">
						<label for="storeContent" class="mb-3"><h5>내용</h5></label>
						<textarea id="storeContent" name="storeContent" placeholder="내용을 입력하세요..."></textarea>
					</div>
					
					<!-- 카테고리 태그 -->
					<div class="form-group input">
						<label for="kategorieInput" class="mb-3"><h5>어떤 맛집인가요?</h5></label>
						<div id="kategorieGroup" class="cateGroup">
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '한식', 'kategorieInput')">한식</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '중식', 'kategorieInput')">중식</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '일식', 'kategorieInput')">일식</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '양식', 'kategorieInput')">양식</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '오마카세', 'kategorieInput')">오마카세</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '고기', 'kategorieInput')">고기</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '집맛', 'kategorieInput')">집맛</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '백반', 'kategorieInput')">백반</a>
						</div>
						<input type="text" id="kategorieInput" name="kategorieInput" class="form-control" placeholder="#태그명" readonly>
					</div>

					<!-- 자랑거리 태그 -->
					<div class="form-group input">
						<label for="tagInput" class="mb-3"><h5>자랑거리</h5></label>
						<div id="tagGroup" class="tagGroup">
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '주차가능', 'tagInput')">주차가능</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '음식', 'tagInput')">음식</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, 'wifi', 'tagInput')">wifi</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '놀이시설', 'tagInput')">놀이시설</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '최고 맛집', 'tagInput')">최고 맛집</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '방송 출연', 'tagInput')">방송 출연</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '빨간맛', 'tagInput')">빨간맛</a>
						    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '최고인기', 'tagInput')">최고인기</a>
						</div>
						<input type="text" id="tagInput" name="tagInput" class="form-control" placeholder="#태그명" readonly>
					</div>


		            <button type="submit" class="btn store_btn btn-dark">등록</button>
		        </div>
		    </form>

	    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	    <script src="/js/review_create_form.js"></script>

		<script>
			// 시작 시간과 종료 시간 관련 변수 설정
			const startTimeInput = document.getElementById('StoreStarttime');
			const endTimeInput = document.getElementById('StoreEndTime');
			const errorMessage = document.getElementById('error1');

			// 시간 형식 검증 함수
			function validateTimeFormat(time) {
				const regex = /^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/; // HH:MM 형식 검증
				return regex.test(time);
			}

			// 시간 검증 및 버튼 생성 함수
			function generateButtons() {
				const startTime = startTimeInput.value;
				const endTime = endTimeInput.value;

				if (!startTime && !endTime) {
					errorMessage.style.display = 'none'; // 아무것도 입력되지 않았을 때 에러 메시지 숨김
					return;
				}

				if (!validateTimeFormat(startTime) || !validateTimeFormat(endTime)) {
					errorMessage.style.display = 'block';
					errorMessage.textContent = '*시간 형식이 잘못되었습니다. HH:MM 형식으로 입력하세요.';
					return;
				}

				const start = new Date(`2024-01-01T${startTime}:00`);
				const end = new Date(`2024-01-01T${endTime}:00`);

				if (start >= end) {
					errorMessage.style.display = 'block';
					errorMessage.textContent = '*시작 시간이 끝나는 시간보다 빨라야 합니다.';
					return;
				} else {
					errorMessage.style.display = 'none';
				}
			}

			// 태그 토글 함수
				function toggleTag(button, tag, inputId) {
				    // 선택된 버튼에 'selected' 클래스를 추가하거나 제거
				    button.classList.toggle('selected');
				    
				    // 해당 input 필드를 찾음
				    const input = document.getElementById(inputId);
				    const currentTags = input.value ? input.value.split(', ') : [];

				    // 선택된 태그가 있다면 추가하고, 해제된 태그는 제거
				    if (button.classList.contains('selected')) {
				        if (!currentTags.includes(tag)) {
				            currentTags.push(tag);
				        }
				    } else {
				        const index = currentTags.indexOf(tag);
				        if (index > -1) {
				            currentTags.splice(index, 1);
				        }
				    }

				    // 선택된 태그들을 input 필드에 반영
				    input.value = currentTags.join(', ');
				}

			// 주소 검색 및 좌표 가져오는 함수
			let timeout = null;

			document.getElementById('basicAddress').addEventListener('input', function() {
				clearTimeout(timeout);
				const basicAddress = this.value;
				const detailAddress = document.getElementById('detailAddress').value;

				if (basicAddress) {
					timeout = setTimeout(() => {
						getCoordinates(basicAddress, detailAddress);
					}, 500); // 500ms 후에 API 호출
				} else {
					document.getElementById('result').innerText = '';
				}
			});

			document.getElementById('detailAddress').addEventListener('input', function() {
				clearTimeout(timeout);
				const basicAddress = document.getElementById('basicAddress').value;

				if (basicAddress) {
					timeout = setTimeout(() => {
						getCoordinates(basicAddress, this.value); // 기본 주소와 상세 주소로 호출
					}, 500); // 500ms 후에 API 호출
				} else {
					document.getElementById('result').innerText = '';
				}
			});

			async function getCoordinates(basicAddress, detailAddress) {
				const apiKey = 'AIzaSyDNDLO6UZO7gnvqpdjk5CALPXeWx08sOnM'; // API 키를 여기에 입력하세요
				const fullAddress = detailAddress ? `${basicAddress} ${detailAddress}` : basicAddress;
				const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(fullAddress)}&key=${apiKey}`);
				const data = await response.json();
				
				if (data.status === 'OK') {
					const location = data.results[0].geometry.location;
					document.getElementById('storeLatitude').value = location.lat; // 위도 입력
					document.getElementById('storeLongitude').value = location.lng; // 경도 입력
					document.getElementById('result').innerText = '';
				} else {
					document.getElementById('result').innerText = '주소를 찾을 수 없습니다.';
					document.getElementById('storeLatitude').value = '';
					document.getElementById('storeLongitude').value = '';
				}
			}

			// Daum Postcode API를 이용한 주소 검색
			function sample6_execDaumPostcode() {
				new daum.Postcode({
					oncomplete: function(data) {
						document.getElementById('postcode').value = data.zonecode; // 우편번호
						document.getElementById('basicAddress').value = data.roadAddress || data.jibunAddress; // 기본 주소
						getCoordinates(data.roadAddress || data.jibunAddress); // 주소 선택 후 바로 위도, 경도 찾기
						document.getElementById('detailAddress').focus(); // 상세 주소 입력 필드로 포커스
					}
				}).open();
			}
		</script>
</div>
</html>