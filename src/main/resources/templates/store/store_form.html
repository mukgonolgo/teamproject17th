
<html layout:decorate="~{layout}">
	<div layout:fragment="content">
		<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

	    <style>
			.S1_d_cr {
			    background-color: #ffffff;
			    padding: 20px;
			    max-width: 800px;
			    margin: 0 auto;
			    border: 1px solid #e0e0e0;
			    box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
			}
			
			label {
			    font-size: 14px;
			    color: #333333;
			    display: block;
			    margin-bottom: 8px;
			}

			select,
			input[type="text"],
			textarea {
			    width: 100%;
			    padding: 10px;
			    margin-bottom: 20px;
			    border: 1px solid #e0e0e0;
			    border-radius: 4px;
			    font-size: 14px;
			    box-sizing: border-box;
			}

			textarea {
			    height: 150px;
			    resize: none;
			}




			button[type="submit"] {
			    width: 100%;
			    background-color: rgb(255, 223, 228);
			    color: white;
			    padding: 12px;
			    border: none;
			    border-radius: 4px;
			    font-size: 16px;
			    cursor: pointer;
			}

			button[type="submit"]:hover {
			    background-color: rgb(128, 128, 128);
			}

			.product-info {
			    display: flex;
			    gap: 10px;
			}

			.product-info input {
			    flex: 1;
			}

			/* 카테고리 크기 조절 */
			select {
			    max-width: 300px;
			}

			/* 커스텀 파일 선택 스타일 */
			.file-upload {
			    display: flex;
			    align-items: center;
			}

			.icon-container {
			    display: flex;
			    align-items: center;
			    gap: 5px;
			    /* 이미지와 + 버튼 사이의 간격 조절 */
			}

			.icon {
			    width: 100px;
			    height: 100px;
			    background-color: #fafafa;
			    border: 2px dashed #d0d0d0;
			    border-radius: 4px;
			    text-align: center;
			    cursor: pointer;
			    display: flex;
			    align-items: center;
			    justify-content: center;
			}
			.S1_d_cr_title{
				display: flex;
				justify-content: center;
				padding: 50px;
			}

			.uploaded-image {
			    width: 100px;
			    height: 100px;
			    object-fit: cover;
			    border-radius: 4px;
			    border: 1px solid #e0e0e0;
			}

			.img-container {
			    position: relative;
			    width: 100px;
			    height: 100px;
			}
			
	        .tag-btn {
	            margin: 5px 0 5px 5px;
	            background-color: #d0d0d0;
	        }
			.input{
				margin: 20px 0 10px;
			}
	        .selected {
	            background-color: #007bff; /* 선택된 버튼의 배경색 */
	            color: white; /* 선택된 버튼의 글자색 */
	        }
	        .error-message {
	            color: red;
	            margin-top: 10px;
				font-size: 10px;
	        }
			.cateGroup,.tagGroup{
				display: flex;
				justify-content: center;
				flex-wrap: wrap;
				margin: 50px 0 30px;
			}
			.storaddress>.form-group {
			    display: flex;
			    align-items: center;
			    margin-bottom: 10px;
				
			}
			.required{
				margin-right: 2px;
			}

			.address-button {
			    padding: 7px;
			    border-radius: 5px;
			    background-color: #ddd;
			    border: 1px solid #ccc;
			    cursor: pointer;
				margin-bottom: 20px;

				white-space: nowrap;
			}
			.store_btn{
				margin: 90px 0 70px;
			}
			
			
			
			
			
			/* 반응형 스타일 */
			@media (max-width: 800px) { /* col-lg 이하 */
				.S1_d_cr {
				    border: none;
				    box-shadow: none;
				}

			}


			
	    </style>
	</head>
	<body>
		
	    <form id="storeForm" th:action="@{/store/create}" method="post">
			

	        <input type="hidden" name="_csrf.parameterName" value="${_csrf.token}" />
	        <div class="S1_d_cr">
				<h2 class="S1_d_cr_title">식당 등록</h2>
				<div class="form-group input">
					<label for="storeName"><h5>식당 이름</h5></label>
					<input type="text" id="storeName" name="storeName" placeholder="제목을 입력하세요...">
				</div>


			
				<div class="form-group input">
	            	<label for="file-upload" class="mb-3"><h5>파일(식당 외관, 음식, 메뉴사진을 추가해 주세요!)</h5></label>       
	                <div class="icon-container">
	                    <div class="icon" id="add-icon" onclick="document.getElementById('file-upload').click();">
	                        <span id="file-icon" style="font-size: 50px; color: #d0d0d0;">+</span>
	                    </div>
	                    <input type="file" id="file-upload" name="fileUpload" accept="image/*" onchange="addImage(event)" style="display: none;" multiple>
	                </div>
	            </div>
				<div class="form-group input">
					<div class="form-group">
						<label for="storeNumber" class="mb-3"><h5>전화번호</h5></label>
						<input type="text" id="storeNumber" name="storeNumber" placeholder="'-'빼고 입력해 주세요">
					</div>
				</div>
	            <div class="storetimegroup input">
					<h5 class="mb-3">영업시간</h5>
	                <div class="time_check row">				
	                    <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
	                        <label for="StoreStarttime">시작 시간:</label>
	                        <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreStarttime" id="StoreStarttime" placeholder="00:00 형식으로 입력" oninput="generateButtons()" />
	                    </div>              
	                    <p class="d-none d-md-flex mt-1 align-items-center">~</p>    
	                    <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
	                        <label for="StoreEndTime">마감 시간:</label>
	                        <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreEndTime" id="StoreEndTime" placeholder="00:00 형식으로 입력" oninput="generateButtons()" />
	                    </div>
	                </div>
					

	                <div class="error-message" id="error1" style="display: none;"></div>
	            </div>
				<div class="storetimegroup input">
					<h5 class="mb-3">식당 매뉴!!!</h5>
				    <div class="time_check row">				
				        <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
				            <label for="StoreStarttime">메뉴 이름</label>
				            <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreStarttime" id="StoreStarttime" placeholder="ex 짜장면" oninput="generateButtons()" />
				        </div>              
				        <p class="d-none d-md-flex mt-1 align-items-center">~</p>    
				        <div class="form-group col-9 col-md-5 d-flex m-1 align-items-center" style="white-space: nowrap;">
				            <label for="StoreEndTime">메뉴 가격</label>
				            <input class="ml-2 pl-2 mb-2 time-input" type="text" name="StoreEndTime" id="StoreEndTime" placeholder="ex 5000" oninput="generateButtons()" />
				        </div>
				    </div>
					

				    <div class="error-message" id="error1" style="display: none;"></div>
				</div>

				<div class="storaddress input">
					<h5 class="mb-3">주소 입력</h5>
					<!-- 우편번호 -->
					<div class="form-group m-1 ">
					    <label class="mb-4"	><span class="required" col-5>*</span>우편 번호</label>
					    <input type="text" id="postcode" class="ml-2 col-6 col-md-3 " readonly required>
					   <button type="button" class="address-button ml-2 col-3 col-md-2" onclick="sample6_execDaumPostcode()">주소 찾기</button>
					</div>
					<!-- 기본 주소 -->
					<div class="form-group m-1">
					    <label class="mb-4"><span class="required">*</span>기본 주소</label>
					    <input type="text" id="basicAddress" class="ml-2 col-9 col-md-5" readonly required>
					</div>

					<!-- 상세 주소 -->
					<div class="form-group m-1">
					    <label class="mb-4"><span class="required">*</span>상세 주소</label>
					    <input type="text" id="detaildetilAddress" class="ml-2 col-9 col-md-5" required>
					</div>	
					<!-- 위도 및 경도를 가로로 나열 -->
					<div class="">
					    <div class="form-group">
					        <label class="mb-4"><span class="required">*</span>위도</label>
					        <input type="text" id="storeLatitude" class="col-12 col-md-5" readonly>
					    </div>
					    <div class="form-group ">
					        <label class="mb-4"><span class="required">*</span>경도</label>
					        <input type="text" id="storeLongitude" class="col-12 col-md-5" readonly>
					    </div>
					</div>
					<p id="result"></p>			
				</div>


				<div class="form-group input">
					<label for="storeContent"class="mb-3" ><h5>내용</h5></label>
					<textarea id="storeContent" name="storeContent" placeholder="내용을 입력하세요..."></textarea>
				</div>
				
				
				
				<div class="form-group input">
					<label for="kategorieGroup" class="mb-3"><h5>어떤 맛집인가요?</h5></label>
				    <div id="kategorieGroup" class="cateGroup">
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '한식', 'kategorieGroup')">한식</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '중식', 'kategorieGroup')">중식</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '일식', 'kategorieGroup')">일식</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '양식', 'kategorieGroup')">양식</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '오마카세', 'kategorieGroup')">오마카세</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '고기', 'kategorieGroup')">고기</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '집맛', 'kategorieGroup')">집맛</a>
				        <a type="button" class="btn tag-btn" onclick="toggleTag(this, '백반', 'kategorieGroup')">백반</a>
				    </div>
				    <input type="text" id="kategorieGroup" name="kategorieGroup" class="form-control" placeholder="#태그명" readonly>
				</div>


	            <div class="form-group input">
					<label for="tagGroups" class="mb-3"><h5>자랑거리</h5></label>
	                <div id="storeTagGroups" class="tagGroup">
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '주차가능', 'storeTagGroups')">주차가능</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '음식', 'storeTagGroups')">음식</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, 'wifi', 'storeTagGroups')">wifi</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '놀이시설', 'storeTagGroups')">놀이시설</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '최고 맛집', 'storeTagGroups')">최고 맛집</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '방송 출연', 'storeTagGroups')">방송 출연</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '빨간맛', 'storeTagGroups')">빨간맛</a>
	                    <a type="button" class="btn tag-btn" onclick="toggleTag(this, '최고인기', 'storeTagGroups')">최고인기</a>
	                </div>
					<input type="text" id="storeTagGroups" name="storeTagGroups" class="form-control" placeholder="#태그명" readonly>
	            </div>

	            <button type="submit" class="btn store_btn btn-dark">등록</button>
	        </div>
	    </form>

	    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	    <script src="/js/review_create_form.js"></script>

	    <script>
	        const startTimeInput = document.getElementById('startTime');
	        const endTimeInput = document.getElementById('endTime');
	        const errorMessage = document.getElementById('error1');
	        

	        function validateTimeFormat(time) {
	            const regex = /^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/; // HH:MM 형식 검증
	            return regex.test(time);
	        }

	        function generateButtons() {
	            
	            const startTime = startTimeInput.value;
	            const endTime = endTimeInput.value;

	            if (!startTime && !endTime) {
	                errorMessage.style.display = 'none'; // 아무것도 입력되지 않았을 때 에러 메시지 숨김
	                return;
	            }

	            if (!validateTimeFormat(startTime) || !validateTimeFormat(endTime)) {
	                errorMessage.style.display = 'block';
	                errorMessage.textContent = '*시간 형식이 잘못되었습니다. HH:MM 형식으로 입력하세요.';
	                return;
	            }

	            const start = new Date(`2024-01-01T${startTime}:00`);
	            const end = new Date(`2024-01-01T${endTime}:00`);

	            if (start >= end) {
	                errorMessage.style.display = 'block';
	                errorMessage.textContent = '*시작 시간이 끝나는 시간보다 빨라야 합니다.';
	                return;
	            } else {
	                errorMessage.style.display = 'none';
	            }

	            // 추가적인 버튼 생성 로직을 여기에 작성할 수 있습니다.
	        }
	        function toggleTag(button, tag, group) {
	            button.classList.toggle('selected'); // 버튼 색상 변경
	            const input = document.getElementById(group);
	            const currentTags = input.value ? input.value.split(', ') : [];

	            if (button.classList.contains('selected')) {
	                // 선택된 태그 추가
	                if (!currentTags.includes(tag)) {
	                    currentTags.push(tag);
	                }
	            } else {
	                // 선택 해제된 태그 제거
	                const index = currentTags.indexOf(tag);
	                if (index > -1) {
	                    currentTags.splice(index, 1);
	                }
	            }
	            input.value = currentTags.join(', '); // 인풋창에 선택한 태그 표시
	        }
			

			
			//주소검색 경도 위도 검색
			
			let timeout = null;

			document.getElementById('basicAddress').addEventListener('input', function() {
			    clearTimeout(timeout);
			    const basicAddress = this.value;
			    const detailAddress = document.getElementById('detailAddress').value;

			    if (basicAddress) {
			        timeout = setTimeout(() => {
			            getCoordinates(basicAddress, detailAddress);
			        }, 500); // 500ms 후에 API 호출
			    } else {
			        document.getElementById('result').innerText = '';
			    }
			});

			document.getElementById('detailAddress').addEventListener('input', function() {
			    clearTimeout(timeout);
			    const basicAddress = document.getElementById('basicAddress').value;

			    if (basicAddress) {
			        timeout = setTimeout(() => {
			            getCoordinates(basicAddress, this.value); // 기본 주소와 상세 주소로 호출
			        }, 500); // 500ms 후에 API 호출
			    } else {
			        document.getElementById('result').innerText = '';
			    }
			});

			async function getCoordinates(basicAddress, detailAddress) {
			    const apiKey = 'AIzaSyDNDLO6UZO7gnvqpdjk5CALPXeWx08sOnM'; // API 키를 여기에 입력하세요
			    const fullAddress = detailAddress ? `${basicAddress} ${detailAddress}` : basicAddress;
			    const response = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(fullAddress)}&key=${apiKey}`);
			    const data = await response.json();
			    
			    if (data.status === 'OK') {
			        const location = data.results[0].geometry.location;
			        document.getElementById('latitude').value = location.lat; // 위도 입력
			        document.getElementById('longitude').value = location.lng; // 경도 입력
			        document.getElementById('result').innerText = '';
			    } else {
			        document.getElementById('result').innerText = '주소를 찾을 수 없습니다.';
			        document.getElementById('latitude').value = '';
			        document.getElementById('longitude').value = '';
			    }
			}

			function sample6_execDaumPostcode() {
			    new daum.Postcode({
			        oncomplete: function(data) {
			            document.getElementById('postcode').value = data.zonecode; // 우편번호
			            document.getElementById('basicAddress').value = data.roadAddress || data.jibunAddress; // 기본 주소
			            getCoordinates(data.roadAddress || data.jibunAddress); // 주소 선택 후 바로 위도, 경도 찾기
			            document.getElementById('detailAddress').focus(); // 상세 주소 입력 필드로 포커스
			        }
			    }).open();
			}
			
	    </script>
</div>
</html>
